<!DOCTYPE html>
<html>
<head></head>
<body>
	
  <h1 style='text-align: center; margin-bottom: -35px;'>Image labeling webapp</h1>
  <br><br>
	
	
<!-- OCR webapp -->
   <h2 id="select_model" style='text-align: left; display:none'>Write a captial letter or number in the box, click the button to classify</h2>
   
		
<!-- Once image and model are selected, make image appear in canvas and run model -->
   <div style="width:100%;height:100%;position:absolute;vertical-align:middle;text-align:left;">
        <canvas id="canvasId" width="224" height="224" style="display:block"></canvas>
    <div>

      <div style="width:100%;height:100%;position:absolute;vertical-align:middle;text-align:left;">
        <button id="run_saved_classifer" onclick="run_saved_classifer()" style="display:block">run_saved_classifer</button>
    <div>

    <div id="output" style="font-family:courier;font-size:24px;height:300px"></div>

	    
<style>
      canvas {border: 1px solid black;}
    </style>
  
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"> </script>

  
<script>
  // https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/drawImage
  var canvasElement = document.getElementById("canvasId");
  const ctx = canvasElement.getContext("2d");

  // -------------------------------------------------
	
  const outp = document.getElementById('output');

  // -------------------------------------------------

// let mouse = new MouseEvent("click", {
//     bubbles: true,
//     cancelable: true,
//     view: window,
//   });
	
  // eventlistener for mousedown
  const selectCanvas = document.getElementById('canvasId');
	
  selectCanvas.addEventListener("mousedown", (e) => {
     ctx.moveTo(e.clientX, e.clientY-20);
     ctx.beginPath();
     selectCanvas.addEventListener("mousemove", createlines, false);
  }, false);
	


  var createlines = function(e){
	     ctx.lineTo(e.clientX, e.clientY-20);
	     ctx.stroke();
  };
	
  // -------------------------------------------------
	
  selectCanvas.addEventListener("mouseup", () => {

	  selectCanvas.removeEventListener('mousemove', createlines, false);

	  const img = new Image();
  img.onload = () => {
ctx.drawImage(img, 0, 0, 28, 28);
  };
	  //img.src = selectCanvas.toDataURL('image/png');

	    }, false);
  // -------------------------------------------------

  async function run_saved_classifer(){
 
        // const MODEL_URL = 'https://storage.googleapis.com/tensorflowjsmodels0/model.json';
	      const MODEL_URL = 'model.json';
        const model = await tf.loadLayersModel(MODEL_URL);
          
	const image = new Image();

	image.src = await load_image_basedOn_selection();
          
	image.onload = async function (){
		  
            // Draw image on canvas
            document.getElementById("canvasId").style.display = "block";
            ctx.drawImage(image, 0,0);
	}
	  
  }  // end of run_saved_classifer

	

</script>
</body>
</html>
